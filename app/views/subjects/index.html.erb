<!-- every page is already in a container from application.html.erb -->

<div class='d-flex justify-content-between my-4 '>
  <h1>Your Classes</h1>

  <button class="btn btn-sammi" type="button" data-toggle="modal" data-target="#exampleModal">
    Add new class
  </button>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content" style='border-radius:10px'>
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel">New Class</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <%= render 'shared/new_class' %>
        </div>
      </div>
    </div>
  </div>
</div>
<div class='row'>
  <% @subjects.each do |subject| %>
    <div class='col-12 col-lg-6'>
      <%= link_to subject_path(subject) do %>

        <div class="card-subjects">
          <img src='<%= asset_path(subject.photo) %>'/>
          <div class="card-subjects-infos">
            <h2><%= subject.name %></h2>
            <div class='d-flex justify-content-between'>
                <p><%= subject.class_members.length %> students</p>
                <% length = subject.class_members.count %>
                <% hsh = subject.class_members.map { |stu| stu.daily_emotions.first.emotion.number }.group_by{|r| r}.map { |key, value| { key => value.length } }.map { |i| i.map { |key, value| { key => (value / length.to_f) * 100 } } }.map { |i| i.first }.reduce Hash.new, :merge %>
                <% final = hsh.map {|k, v| k * v }.sum / 100 %>
                <div id='emotion'><%= Emotion.find(final.round).rating %></div>
                <!-- <div id='emotion'><%= Emotion.find(@emo_average.round).rating %></div> -->
            </div>
            <br>
            <div class="progress">
              <div class="progress-bar" role="progressbar" style="background-color: <%= Emotion.first.color %>;width: <%= @emo_index[Emotion.first.number] %>%" aria-valuenow="<%= @emo_index[Emotion.first.number] %>" aria-valuemin="0" aria-valuemax="100" data-toggle='tooltip' data-placement="top" title="<%= Emotion.first.rating %>"></div>
              <div class="progress-bar" role="progressbar" style="background-color: <%= Emotion.second.color %>; width: <%= @emo_index[Emotion.second.number] %>%" aria-valuenow="<%= @emo_index[Emotion.second.number] %>" aria-valuemin="0" aria-valuemax="100" data-toggle='tooltip' data-placement="top" title="<%= Emotion.first.rating %>"></div>
              <div class="progress-bar" role="progressbar" style="background-color: <%= Emotion.third.color %>; width: <%= @emo_index[Emotion.third.number] %>%" aria-valuenow="<%= @emo_index[Emotion.third.number] %>" aria-valuemin="0" aria-valuemax="100" data-toggle='tooltip' data-placement="top" title="<%= Emotion.first.rating %>"></div>
              <div class="progress-bar" role="progressbar" style="background-color: <%= Emotion.fourth.color %>; width: <%= @emo_index[Emotion.fourth.number] %>%" aria-valuenow="<%= @emo_index[Emotion.fourth.number] %>" aria-valuemin="0" aria-valuemax="100" data-toggle='tooltip' data-placement="top" title="<%= Emotion.first.rating %>"></div>
              <div class="progress-bar" role="progressbar" style="background-color: <%= Emotion.fifth.color %>; width: <%= @emo_index[Emotion.fifth.number] %>%" aria-valuenow="<%= @emo_index[Emotion.fifth.number] %>" aria-valuemin="0" aria-valuemax="100" data-toggle='tooltip' data-placement="top" title="<%= Emotion.first.rating %>"></div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</div>
